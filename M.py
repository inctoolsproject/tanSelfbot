from linepy import *
from liff.ttypes import LiffChatContext, LiffContext, LiffSquareChatContext, LiffNoneContext, LiffViewRequest
from akad.ttypes import Message
from akad.ttypes import ContentType as Type
from akad.ttypes import TalkException
from datetime import datetime, timedelta
from time import sleep
from bs4 import BeautifulSoup as bSoup
from bs4 import BeautifulSoup
from humanfriendly import format_timespan, format_size, format_number, format_length
from gtts import gTTS
from threading import Thread
from io import StringIO
from multiprocessing import Pool
from googletrans import Translator
from urllib.parse import urlencode
from tmp.MySplit import *
from random import randint
from shutil import copyfile
from youtube_dl import YoutubeDL
import subprocess, youtube_dl, humanize, traceback
import subprocess as cmd
import platform
import requests, json
import time, random, sys, json, null, pafy, codecs, html5lib ,shutil ,threading, glob, re, base64, string, os, requests, six, ast, pytz, wikipedia, urllib, urllib.parse, atexit, asyncio, traceback
_session = requests.session()
try:
    import urllib.request as urllib2
except ImportError:
    import urllib2
#==============================================================================#
boy = LineClient()
#boy = LineClient(authToken=' TOKEN MU CINTA')
boy.log("Auth Token : " + str(boy.authToken))
channel = LineChannel(boy)
boy.log("Channel Access Token : " + str(channel.channelAccessToken))
#==============================================================================#
k1 = LineClient()
#k1 = LineClient(authToken=' TOKEN MU CINTA')
k1.log("Auth Token : " + str(k1.authToken))
channel1 = LineChannel(k1)
k1.log("Channel Access Token : " + str(channel1.channelAccessToken))
#==============================================================================#
k2 = LineClient()
#k2 = LineClient(authToken=' TOKEN MU CINTA')
k2.log("Auth Token : " + str(k2.authToken))
channel2 = LineChannel(k2)
k2.log("Channel Access Token : " + str(channel2.channelAccessToken))
#==============================================================================#
k3 = LineClient()
#k3 = LineClient(authToken=' TOKEN MU CINTA')
k3.log("Auth Token : " + str(k3.authToken))
channel3 = LineChannel(k3)
k3.log("Channel Access Token : " + str(channel3.channelAccessToken))
#==============================================================================#
k4 = LineClient()
#k4 = LineClient(authToken=' TOKEN MU CINTA')
k4.log("Auth Token : " + str(k4.authToken))
channel4 = LineChannel(k4)
k4.log("Channel Access Token : " + str(channel4.channelAccessToken))
#==============================================================================#
k5 = LineClient()
#k5 = LineClient(authToken=' TOKEN MU CINTA')
k5.log("Auth Token : " + str(k5.authToken))
channel5 = LineChannel(k5)
k5.log("Channel Access Token : " + str(channel5.channelAccessToken))
#==============================================================================#
k6 = LineClient()
#k6 = LineClient(authToken=' TOKEN MU CINTA')
k6.log("Auth Token : " + str(k6.authToken))
channel6 = LineChannel(k6)
k6.log("Channel Access Token : " + str(channel6.channelAccessToken))
#==============================================================================#
k7 = LineClient()
#k7 = LineClient(authToken=' TOKEN MU CINTA')
k7.log("Auth Token : " + str(k7.authToken))
channel7 = LineChannel(k7)
k7.log("Channel Access Token : " + str(channel7.channelAccessToken))
#==============================================================================#
k8 = LineClient()
#k8 = LineClient(authToken=' TOKEN MU CINTA')
k8.log("Auth Token : " + str(k8.authToken))
channel8 = LineChannel(k8)
k8.log("Channel Access Token : " + str(channel8.channelAccessToken))
#==============================================================================#
k9 = LineClient()
#k9 = LineClient(authToken=' TOKEN MU CINTA')
k9.log("Auth Token : " + str(k9.authToken))
channel9 = LineChannel(k9)
k9.log("Channel Access Token : " + str(channel9.channelAccessToken))
#==============================================================================#
k10 = LineClient()
#k10 = LineClient(authToken=' TOKEN MU CINTA')
k10.log("Auth Token : " + str(k10.authToken))
channel10 = LineChannel(k10)
k10.log("Channel Access Token : " + str(channel10.channelAccessToken))
#==============================================================================#
sw = LineClient()
#sw = LineClient(authToken=' TOKEN MU CINTA')
sw.log("Auth Token : " + str(sw.authToken))
channel = LineChannel(sw)
sw.log("Channel Access Token : " + str(channel.channelAccessToken))
#==============================================================================#
poll = LinePoll(boy)
poll = LinePoll(k1)
poll = LinePoll(k2)
poll = LinePoll(k3)
poll = LinePoll(k4)
poll = LinePoll(k5)
poll = LinePoll(k6)
poll = LinePoll(k7)
poll = LinePoll(k8)
poll = LinePoll(k9)
poll = LinePoll(k10)
call = boy
creator = ["uda8195e53e6c6e17f3f745743e477100"]
owner = ["uda8195e53e6c6e17f3f745743e477100"]
admin = ["uda8195e53e6c6e17f3f745743e477100"]
staff = ["uda8195e53e6c6e17f3f745743e477100"]
mid = boy.getProfile().mid
Amid = k1.getProfile().mid
Bmid = k2.getProfile().mid
Cmid = k3.getProfile().mid
Dmid = k4.getProfile().mid
Emid = k5.getProfile().mid
Fmid = k6.getProfile().mid
Gmid = k7.getProfile().mid
Hmid = k8.getProfile().mid
Imid = k9.getProfile().mid
Jmid = k10.getProfile().mid
Zmid = sw.getProfile().mid
KAC = [boy,k1,k2,k3,k4,k5,k6,k7,k8,k9,k10,sw]
ABC = [boy,k1,k2,k3,k4,k5,k6,k7,k8,k9,k10,sw]
Bots = [mid,Amid,Bmid,Cmid,Dmid,Emid,Fmid,Gmid,Hmid,Imid,Jmid,Zmid]
Aditmadzs = admin + staff + creator

protectqr = []
protectkick = []
protectjoin = []
protectinvite = []
protectcancel = []
protectantijs = []
ghost = []

welcome = []
simisimi = []
translateen = []
translateid = []
translateth = []
translatetw = []
translatear = []

myProfile = {
	"displayName": "",
	"statusMessage": "",
	"pictureStatus": ""
}

boyProfile = boy.getProfile()
myProfile["displayName"] = boyProfile.displayName
myProfile["statusMessage"] = boyProfile.statusMessage
myProfile["pictureStatus"] = boyProfile.pictureStatus

responsename1 = k1.getProfile().displayName
responsename2 = k2.getProfile().displayName
responsename3 = k3.getProfile().displayName
responsename4 = k4.getProfile().displayName
responsename5 = k5.getProfile().displayName
responsename6 = k6.getProfile().displayName
responsename7 = k7.getProfile().displayName
responsename8 = k8.getProfile().displayName
responsename9 = k9.getProfile().displayName
responsename10 = k10.getProfile().displayName
responsename = sw.getProfile().displayName

cctv = {
    "cyduk":{},
    "point":{},
    "sidermem":{}
}

with open('creator.json', 'r') as fp:
    creator = json.load(fp)
with open('owner.json', 'r') as fp:
    owner = json.load(fp)
with open('admin.json', 'r') as fp:
    admin = json.load(fp)    

Setbot1 = codecs.open("setting.json","r","utf-8")
Setmain = json.load(Setbot1)
Setbot2 = codecs.open("settings.json","r","utf-8")
settings = json.load(Setbot2)
Setbot3 = codecs.open("wait.json","r","utf-8")
wait = json.load(Setbot3)
Setbot4 = codecs.open("read.json","r","utf-8")
read = json.load(Setbot4)
#==============================================================================#
clMID = cl.profile.mid
clProfile = cl.getProfile()
clSettings = cl.getSettings()
#==============================================================================#
clPoll = OEPoll(cl)
clMID = cl.getProfile().mid
cladmin = [lineMID]
loop = asyncio.get_event_loop()
listToken = ['desktopmac','desktopwin','iosipad','chromeos','win10']
mc = {"wr":{}}
unsendchat = {}
msgdikirim = {}
msg_image={}
msg_video={}
msg_sticker={}
wbanlist = []
msg_dict = {}
temp_flood = {}

#==============================================================================#
sets = {
    'autoCancel':{"on":False,"members":10},	
    "pict": True,
    "sti2": True,
    "tagsticker": False,
    "Sticker": False,
    "autoJoinTicket": False,
    "image": {
        "name": "",
    },
    "addSticker": {
        "name": "",
        "status": False,
    },
    "messageSticker": {
        "addName": "",
        "addStatus": False,
        "listSticker": {
            "tag": {
                "STKID": "",
                "STKPKGID": "",
                "STKVER": ""
            },
            "lv": {
                "STKID": "",
                "STKPKGID": "",
                "STKVER": ""
            },
            "wc": {
                "STKID": "",
                "STKPKGID": "",
                "STKVER": ""
            },
            "add": {
                "STKID": "",
                "STKPKGID": "",
                "STKVER": ""
            },
            "join2": {
                "STKID": "",
                "STKPKGID": "",
                "STKVER": ""
            },
        }
    },
    "ilstpict": {},
}
chatbot = {
    "admin": [],
    "botMute": [],
    "botOff": [],
}

anyun = {
    "addTikel": {
        "name": "",
        "status": False
        },
}
nissa = {
    "addTikel2": {
        "name": "",
        "status": False
        },
}
tagadd = {
    "tagss": False,
    "tags": False,
    "tag": "à¸§à¸´à¸˜à¸µà¸•à¸±à¹‰à¸‡à¹à¸—à¸„ \n- à¸•à¸±à¹‰à¸‡à¹à¸—à¸„ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£",
    "add": "à¸¢à¸´à¸™à¸”à¸µà¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸¹à¹‰à¸ˆà¸±à¸à¸™à¸°à¸„à¸£à¸±à¸š ðŸ˜ƒ\nà¸£à¸±à¸šà¹à¸­à¸”à¸¥à¸°à¸™à¹‰à¸². >_<",
    "wctext": "",
    "lv": "à¸šà¹Šà¸²à¸¢à¸šà¸²à¸¢ >< à¸‚à¸­à¹ƒà¸«à¹‰à¹€à¸˜à¸­à¹‚à¸Šà¸„à¸”à¸µà¸‡à¸±à¸š >_<",
    "b": "à¸šà¸±à¸à¸Šà¸µà¸™à¸µà¹‰à¸–à¸¹à¸à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸”à¹‰à¸§à¸¢ à¹à¸¡à¹‰à¸„à¸™à¸²à¸¢à¸¡à¸±à¸™à¸«à¸¥à¹ˆà¸­  à¸£à¸°à¸šà¸šà¹„à¸”à¹‰à¸šà¸¥à¹‡à¸­à¸„à¸šà¸±à¸à¸Šà¸µà¸„à¸¸à¸“à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ >_<",
    "m": "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¸£à¸±à¸š à¸œà¸¡à¸¡à¸¸à¸”à¸¥à¸´à¹‰à¸‡à¸¡à¸²à¸™à¸°à¸„à¸£à¸±à¸š >_<",
}
apalo = {
    "blacklist":{},
    "Talkblacklist": {},
    "talkban": True,
    "Talkwblacklist": False,
    "Talkdblacklist": False,
}
temp = {"te": "#CC0033","t": "#000000"}
read = {
    "readPoint": {},
    "readMember": {},
    "readTime": {},
    "setTime":{},
    "ROM": {}
}
rfuSet = {
    'setTime':{},
    'ricoinvite':{},
    'winvite':{},
    }

ProfileMe = {
    "coverId": "",
    "statusMessage": "",
    "PictureMe": "",
    "NameMe": "",
}
peler = { 
    "receivercount": 0,
    "sendcount": 0
}
hoho = {
    "savefile": False,
    "namefile": "",
}

user1 = clMID
user2 = ""

setTime = {}
setTime = rfuSet['setTime']

contact = if.getProfile() 
backup = if.getProfile() 
backup.dispalyName = contact.displayName 
backup.statusMessage = contact.statusMessage
backup.pictureStatus = contact.pictureStatus

mulai = time.time()
Start = time.time()

tz = pytz.timezone("Asia/Jakarta")
timeNow = datetime.now(tz=tz)

settings["myProfile"]["displayName"] = ifProfile.displayName
settings["myProfile"]["statusMessage"] = ifProfile.statusMessage
settings["myProfile"]["pictureStatus"] = ifProfile.pictureStatus
cont = if.getContact(ifMID)
settings["myProfile"]["videoProfile"] = cont.videoProfile
coverId = if.getProfileDetail()["result"]["objectId"]
settings["myProfile"]["coverId"] = coverId

ProfileMe["statusMessage"] = ifProfile.statusMessage
ProfileMe["pictureStatus"] = ifProfile.pictureStatus
coverId = cl.getProfileDetail()["result"]["objectId"]
ProfileMe["coverId"] = coverId
#=====================================================================
with open("max.json", "r", encoding="utf_8_sig") as f:
    anu = json.loads(f.read())
    anu.update(settings)
    settings = anu
with open("Max2.json", "r", encoding="utf_8_sig") as f:
    itu = json.loads(f.read())
    itu.update(wait)
    wait = itu
#==============================================================================#
def RhyN_(to, mid):
    try:
        aa = '{"S":"0","E":"3","M":'+json.dumps(mid)+'}'
        text_ = '@Ma '
        cl.sendMessage(to, text_, contentMetadata={'MENTION':'{"MENTIONEES":['+aa+']}'}, contentType=0)
    except Exception as error:
        logError(error)
def sendMessageCustom(to, text, icon , name):
    annda = {'MSG_SENDER_ICON': icon,
        'MSG_SENDER_NAME':  name,
    }
    cl.sendMessage(to, text, contentMetadata=annda)
def sendMessageCustomContact(to, icon, name, mid):
    annda = { 'mid': mid,
    'MSG_SENDER_ICON': icon,
    'MSG_SENDER_NAME':  name,
    }
    cl.sendMessage(to, '', annda, 13)
def cloneProfile(mid):
    contact = cl.getContact(mid)
    if contact.videoProfile == None:
        cl.cloneContactProfile(mid)
    else:
        profile = cl.getProfile()
        profile.displayName, profile.statusMessage = contact.displayName, contact.statusMessage
        cl.updateProfile(profile)
        pict = cl.downloadFileURL('http://dl.profile.line-cdn.net/' + contact.pictureStatus, saveAs="tmp/pict.bin")
        vids = cl.downloadFileURL( 'http://dl.profile.line-cdn.net/' + contact.pictureStatus + '/vp', saveAs="tmp/video.bin")
        changeVideoAndPictureProfile(pict, vids)
    coverId = cl.getProfileDetail(mid)['result']['objectId']
    cl.updateProfileCoverById(coverId)
def backupProfile():
    profile = cl.getContact(clMID)
    settings['myProfile']['displayName'] = profile.displayName
    settings['myProfile']['pictureStatus'] = profile.pictureStatus
    settings['myProfile']['statusMessage'] = profile.statusMessage
    settings['myProfile']['videoProfile'] = profile.videoProfile
    coverId = cl.getProfileDetail()['result']['objectId']
    settings['myProfile']['coverId'] = str(coverId)
def restoreProfile():
    profile = cl.getProfile()
    profile.displayName = settings['myProfile']['displayName']
    profile.statusMessage = settings['myProfile']['statusMessage']
    if settings['myProfile']['videoProfile'] == None:
        profile.pictureStatus = settings['myProfile']['pictureStatus']
        cl.updateProfileAttribute(8, profile.pictureStatus)
        cl.updateProfile(profile)
    else:
        maxgie.updateProfile(profile)
        pict = cl.downloadFileURL('http://dl.profile.line-cdn.net/' + settings['myProfile']['pictureStatus'], saveAs="tmp/pict.bin")
        vids = cl.downloadFileURL( 'http://dl.profile.line-cdn.net/' + settings['myProfile']['pictureStatus'] + '/vp', saveAs="tmp/video.bin")
        changeVideoAndPictureProfile(pict, vids)
    coverId = settings['myProfile']['coverId']
    cl.updateProfileCoverById(coverId)
def autoresponuy(to,msg,wait):
    to = msg.to
    if msg.to not in wait["GROUP"]['AR']['AP']:
        return
    if msg.to in wait["GROUP"]['AR']['S']:
        cl.sendMessage(msg.to,text=None,contentMetadata=wait["GROUP"]['AR']['S'][msg.to]['Sticker'], contentType=7)
    if(wait["GROUP"]['AR']['P'][msg.to] in [""," ","\n",None]):
        return
    if '@!' not in wait["GROUP"]['AR']['P'][msg.to]:
        wait["GROUP"]['AR']['P'][msg.to] = '@!'+wait["GROUP"]['AR']['P'][msg.to]
    nama = cl.getGroup(msg.to).name
    sd = cl.waktunjir()
    cl.sendMention(msg.to,wait["GROUP"]['AR']['P'][msg.to].replace('greeting',sd).replace(';',nama),'',[msg._from]*wait["GROUP"]['AR']['P'][msg.to].count('@!'))
def ClonerV2(to):
    try:
        contact = cl.getContact(to)
        profile = cl.profile
        profileName = cl.profile
        profileStatus = cl.profile
        profileName.displayName = contact.displayName
        profileStatus.statusMessage = contact.statusMessage
        cl.updateProfile(profileName)
        cl.updateProfile(profileStatus)
        profile.pictureStatus = cl.downloadFileURL('http://dl.profile.line-cdn.net/{}'.format(contact.pictureStatus, 'path'))
        if cl.getProfileCoverId(to) is not None:
            cl.updateProfileCoverById(cl.getProfileCoverId(to))
        cl.updateProfilePicture(profile.pictureStatus)
        print("Success Clone Profile {}".format(contact.displayName))
        return cl.updateProfile(profile)
        if contact.videoProfile == None:
            return "Get Video Profile"
        path2 = "http://dl.profile.line-cdn.net/" + profile.pictureStatus
        cl.updateProfilePicture(path2, 'vp')
    except Exception as error:
        print(error)
#maxg = "ua053fcd4c52917706ae60c811e39d3ea"
def sendMentionFooter(to, mid, firstmessage, lastmessage):
    try:
        arrData = ""
        text = "%s " %(str(firstmessage))
        arr = []
        mention = "@LopeAgri"
        slen = str(len(text))
        elen = str(len(text) + len(mention))
        arrData = {'S':slen, 'E':elen, 'M':mid}
        arr.append(arrData)
        text += mention + str(lastmessage)
        nama = "{}".format(cl.getContact(clMID).displayName)
        img = "http://dl.profile.line-cdn.net/{}".format(cl.getContact(clMID).pictureStatus)
        ticket = "https://line.me/R/ti/p/~ptatan1983"
        cl.sendMessage(to, text, {'AGENT_LINK': ticket, 'AGENT_ICON': img, 'AGENT_NAME': nama, 'MENTION': str('{"MENTIONEES":' + json.dumps(arr) + '}')}, 0)
    except Exception as error:
        logError(error)
        cl.sendMessage(to, "[ INFO ] Error :\n" + str(error))

def mentions(to, text="", mids=[]):
    arrData = ""
    arr = []
    mention = "@STEVENEVERDIE  "
    if mids == []:
        raise Exception("Invalid mids")
    if "@!" in text:
        if text.count("@!") != len(mids):
            raise Exception("Invalid mids")
        texts = text.split("@!")
        textx = ""
        for mid in mids:
            textx += str(texts[mids.index(mid)])
            slen = len(textx)
            elen = len(textx) + 15
            arrData = {'S':str(slen), 'E':str(elen - 4), 'M':mid}
            arr.append(arrData)
            textx += mention
        textx += str(texts[len(mids)])
    else:
        textx = ""
        slen = len(textx)
        elen = len(textx) + 15
        arrData = {'S':str(slen), 'E':str(elen - 4), 'M':mids[0]}
        arr.append(arrData)
        textx += mention + str(text)
    cl.sendMessage(to, textx, {'AGENT_NAME':'LINE OFFICIAL', 'AGENT_LINK': 'line://ti/p/~{}'.format(maxgie.getProfile().userid), 'AGENT_ICON': "http://dl.profile.line-cdn.net/" + cl.getContact("ua053fcd4c52917706ae60c811e39d3ea").picturePath, 'MENTION': str('{"MENTIONEES":' + json.dumps(arr) + '}')}, 0)
def changeVideoAndPictureProfile(pict, vids):
    try:
        files = {'file': open(vids, 'rb')}
        obs_params = cl.genOBSParams({'oid': clMID, 'ver': '2.0', 'type': 'video', 'cat': 'vp.mp4'})
        data = {'params': obs_params}
        r_vp = maxgie.server.postContent('{}/talk/vp/upload.nhn'.format(str(cl.server.LINE_OBS_DOMAIN)), data=data, files=files)
        if r_vp.status_code != 201:
            return "Failed update profile"
        cl.updateProfilePicture(pict, 'vp')
        return "Success update profile"
    except Exception as e:
        raise Exception("Error change video and picture profile {}".format(str(e)))
        os.remove("FadhilvanHalen.mp4")
def sendTemplate(to, data):
    xyz = LiffChatContext(to)
    xyzz = LiffContext(chat=xyz)
    view = LiffViewRequest('1626556804-GvDNyK69', xyzz)
    token = cl.liff.issueLiffView(view)
    url = 'https://api.line.me/v2/bot/message/reply
'
    headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer %s' % token.accessToken
    }
    data = {"messages":[data]}
    requests.post(url, headers=headers, data=json.dumps(data))
def sendTemplate(group, data):
    xyz = LiffChatContext(group)
    xyzz = LiffContext(chat=xyz)
    view = LiffViewRequest('1626556804-GvDNyK69', xyzz)
    token = cl.liff.issueLiffView(view)
    url = 'https://api.line.me/v2/bot/message/reply
'
    headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer %s' % token.accessToken
    }
    data = {"messages":[data]}
    requests.post(url, headers=headers, data=json.dumps(data))
    
def NOTIFIED_READ_MESSAGE(op):
    try:
        if read['readPoint'][op.param1]:
            if op.param2 in read['readMember'][op.param1]:
                pass
            else:
                read['readMember'][op.param1][op.param2] = True
                read['ROM'][op.param1] = op.param2
        else:
            pass
    except:
        pass
def logError(text):
    maxgie.log("[ à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™ ] " + str(text))
    time_ = datetime.now()
    with open("errorLog.txt","a") as error:
        error.write("\n[%s] %s" % (str(time), text))
def command(text):
    pesan = text.lower()
    if settings["setKey"] == True:
        if pesan.startswith(settings["keyCommand"]):
            cmd = pesan.replace(settings["keyCommand"],"")
        else:
            cmd = "Undefined command"
    else:
        cmd = text.lower()
    return cmd
def sendMessage(to, text, contentMetadata={}, contentType=0):
    mes = Message()
    mes.to, mes.from_ = to, profile.mid
    mes.text = text
    mes.contentType,mes.contentMetadata = contentType, contentMetadata
    if to not in messageReq:
        messageReq[to] = -1
    messageReq[to] += 1
def sendMention(to, mid, firstmessage, lastmessage):
    try:
        arrData = ""
        text = "%s " %(str(firstmessage))
        arr = []
        mention = "@x "
        slen = str(len(text))
        elen = str(len(text) + len(mention) - 1)
        arrData = {'S':slen, 'E':elen, 'M':mid}
        arr.append(arrData)
        text += mention + str(lastmessage)
        cl.sendMessage(to, text, {'MENTION': str('{"MENTIONEES":' + json.dumps(arr) + '}')}, 0)
    except Exception as error:
        logError(error)
        cl.sendMessage(to, "[ INFO ] Error :\n" + str(error))
def mentionMembers(to, mid):
    try:
        group = maxgie.getGroup(to)
        mids = [mem.mid
